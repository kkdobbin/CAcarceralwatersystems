---
title: "2024 updated examination of CA carceral water systems"
author: "Kristin Dobbin"
date: "2024-10-23"
output:
  pdf_document: default
  html_document: default
knit: (function(rmdfile, ...) { rmarkdown::render(rmdfile, output_dir=here::here("Docs"))})
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_knit$set(root.dir = "/Users/KristinDobbin/Documents/Projects/R_Projects_Active/CAcarceralwatersystems", warning=FALSE, message=FALSE, include=FALSE)

library(tidyverse)
```


```{r get and prep data, include=FALSE, echo=FALSE}
Data <- read_csv("Data/All_active_CWS_Oct16_2024.csv")
Data <- Data[-c(4,5)]
Data[] <- lapply(Data, factor) #active CWS to use as base sample joining additional data

Inst <- read_csv("Data/FINAL 2023 Inst. type update.csv")
Inst <- Inst[,c(1,4,10,11)]
Inst[] <- lapply(Inst, factor) 

Data <- left_join(Data, Inst, join_by("Water System No." == "PWSID"))

Carceral <- Data %>% filter(Inst_Subtype == "Carceral")
```

## Overview and background

California counts `r nrow(Data)` community water systems. Of these systems,  `r sum(Data$Primacy_FINAL=="EPA Region 9")` are regulated by USA EPA Region 9 due to their location/service on Tribal lands. The remaining `r (nrow(Data)) - sum(Data$Primacy_FINAL=="EPA Region 9")` fall under California regulatory primacy for Safe Drinking Water Act compliance and are regulated by the State Water Resources Control Board and sometimes also their local county, depending on their size. 

Of these systems, `r nrow(Carceral)` specifically exist to serve carceral facilities including jails, prisons and camps. Given that California has approximately 185 such facilities (Not sure about this #!), this subset of water systems represents nearly a quarter of state carceral facilities and are likely among the most rural/isolated facilities. This analysis takes a look at this specific subset of water systems. At the end of the document I discuss other carceral water systems in the state not included in this analysis and the data gaps related to those systems.  

## Carceral water system basics

```{r load more data, include=FALSE, warning=FALSE}
SAFER <- read_csv("Data/SAFER_DASHBOARD_Oct23_2024.csv")#Using this instead of the original 2024 SAFER data due to a mistake in the accessibility_risk_level variable which is fixed in this updated version
SAFER <- SAFER[,c(2,4,5,6,7,8,16:138)]

Data <- left_join(Data, SAFER, join_by("Water System No." == "WATER_SYSTEM_NUMBER"))

Carceral <- Data %>% filter(Inst_Subtype == "Carceral")
```

Cumulatively, these `r nrow(Carceral)` water systems serve  `r sum(Carceral$POPULATION)` people. But on average each individual system serves `r round(mean(Carceral$POPULATION),0)`. `r sum(Carceral$Final_inst_update == "State")` of these systems are State-run systems, most of which are conservation camps and another `r sum(Carceral$Final_inst_update == "County")` are County-run systems, mostly County jails. The systems are located across the sate in `r length(unique(Carceral$COUNTY))` different counties.

```{r county table, echo=FALSE, warning=FALSE}
Carceral$COUNTY <- as.factor(Carceral$COUNTY)
Carceral$COUNTY <- droplevels(Carceral$COUNTY)
knitr::kable(summary(na.omit(Carceral$COUNTY)), col.names = "# of systems")
```

Most of the systems rely on groundwater. 

```{r water source table, echo=FALSE, warning=FALSE}
Carceral$`Primary Source Water Type` <- as.factor(Carceral$`Primary Source Water Type`)
Carceral$`Primary Source Water Type` <- droplevels(Carceral$`Primary Source Water Type`)
levels(Carceral$`Primary Source Water Type`) <- c("Self-produced groundwater", "Purchased groundwater", "Self-produced surface water", "Purcashed surface water")
knitr::kable(summary(Carceral$`Primary Source Water Type`), col.names = "Primary water source")
```



## Carceral system performance 

```{r load SAFER data, echo=FALSE, warning=FALSE, message=FALSE}
Carceral$FINAL_SAFER_STATUS <- as.factor(Carceral$FINAL_SAFER_STATUS)
Data$FINAL_SAFER_STATUS <- as.factor(Data$FINAL_SAFER_STATUS)

Data <- Data %>%
  mutate(Carceral = case_when(Inst_Subtype=="Carceral"~"Carceral",
                              .default = "Not Carceral"))
Data$Carceral <- as.factor(Data$Carceral)

```


According to 2024 California drinking water needs assessment conducted by the State Water Resources Control Board, `r sum(Carceral$FINAL_SAFER_STATUS == "Failing")` (`r round((sum(Carceral$FINAL_SAFER_STATUS == "Failing"))/(nrow(Carceral))*100,2)`%) were found to be at risk and another `r sum(Carceral$FINAL_SAFER_STATUS == "At-Risk")` are potentially at risk. Just `r sum(Carceral$FINAL_SAFER_STATUS == "Not At-Risk")` of the `r nrow(Carceral)` systems are considered not at-risk. 


```{r failing status, echo=FALSE, warning=FALSE, message=FALSE}
Failing <- Data %>% select(Carceral, FINAL_SAFER_STATUS)
library(gtsummary)
Failing_table <- Failing %>%
  tbl_summary(by = Carceral, missing = "no"); Failing_table
```

The following table compares the aggregated risk assessment scores for carceral water systems compared to all other water systems for water quality, accessibility and TMF capacity respectively. 

```{r SAFER scores, echo=FALSE, warning=FALSE, message=FALSE}
DataSmall <- Data %>% select(WATER_QUALITY_RISK_LEVEL, ASSESSIBILITY_RISK_LEVEL, TMF_CAPACITY_RISK_LEVEL, Carceral)
DataSmall <- DataSmall %>% mutate_if(is.character, as.factor)
SAFERscores <- DataSmall %>%
  tbl_summary(by = Carceral, missing = "no"); SAFERscores
```

The following table compares carceral water systems to other systems on the basis of active violations

```{r SAFER violations, echo=FALSE, warning=FALSE}
DataSmall2 <- Data %>% select(PRIMARY_MCL_VIOLATION, SECONDARY_MCL_VIOLATION, E_COLI_VIOLATION, TREATMENT_TECHNIQUE_VIOLATION, MONITORING_AND_REPORTING_VIOLATION, Carceral)

Violations <- DataSmall2 %>%
  tbl_summary(by = Carceral, missing = "no"); Violations
```

## This is an INCOMPLETE look at cerceral water systems 

### Carceral facilities connected to larger water systems

Many of the carceral facilities not addressed herein are connected to larger water systems, in other words, facilities that are receiving water from nearby municipalities or special districts. While there is reason to believe that this larger subset of systems, overall, may have better water access (considering quality but also quantity and future sustainability) to the systems explored herein due to their larger size, there are larger water systems that struggle with these things. Other efforts to identify the water sources for these facilities have used spatial methods, locating facility addresses within water system boundary records, or used planning/permitting records to locate public water system identification numbers.  

### Federal facilities

Based on Dobbin, Fencl and McBride 2023 data, none of the ten federal prisons in California have their own water system yet 6 of 10 are located outside of the public water system boundaries documented in SWRCB's map. Based on internet research, several of these appear to be served by nearby city systems or small state or county operated systems (and thus are included in the above excluded group) but for several we have been unable to identify water sources. 

### Immigration facilities

Various online sources provide different information about how many immigration and detention facilities there are in California, likely the number is in the neighborhood of six or seven. Likely these systems are either co-located with other carceral facilities or served by larger water systems but this should be confirmed.  

### NTNC systems

Finally, in the course of other research efforts, we have identified seven Conservation Camps run by the California Department of Corrections and Cal-Fire are listed in Public Drinking Water Watch as Non-Transient Non-Community water systems. Because the starting point for this analsyis was a list of California Community Water Systems, these systems are currently not included here, nor in the SWRCB's Drinking Water Needs Assessment. Thus SAFER risk scores do not exist for these systems. Nonetheless, as Public Water Systems, there is some data on these systems maintained in the SDWIS database that could be employed in future iterations. 